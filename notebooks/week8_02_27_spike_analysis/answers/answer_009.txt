
# Answer

for i, r in df_files.iterrows():
    print("Processing:", i, r['filepath'])

    data = np.loadtxt(r['filepath'], skiprows=1, delimiter='\t')
    
    # Extract time and data for analysis
    time = data[:, 0]
    experiment_data = data[:, 4] 
    
    # Analysis results for: number of spikes/frequency/time to last spike  
    threshold = 0
    peaks, _ = find_peaks(experiment_data, height=threshold)

    
    inter_spike_intervals = np.diff(peaks)
    num_spike_events = len(peaks)
    
    if num_spike_events > 0:
        spike_frequency = num_spike_events / np.sum(inter_spike_intervals)
    else:
        spike_frequency = np.nan
    
    onset_time = 1
    time_to_last_spike = peaks.max() if num_spike_events > 0 else None

    df_files.loc[i,'spike_count']=num_spike_events
    df_files.loc[i,'spike_frequency']=spike_frequency
    df_files.loc[i,'time_to_last_spike']=time_to_last_spike
